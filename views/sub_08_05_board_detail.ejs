<style>
    .subconbox img {
        max-width: 850px !important;
    }
</style>

<link rel="stylesheet" type="text/css" href="/assets/css/style.bundle.css">
<link rel="stylesheet" type="text/css" href="/stylesheets/style.css">

<div class="gg_wrap">
    <!--gg_in여기까지-->

    <!--sub top nav-->
    <%- include('partials/ggm_topnav.ejs') %>

    <!--gg_topnav여기까지-->


    <!--컨텐츠 시작-->
    <div class="ggcon">

      <!--중간 센터 이미지 -->
      <div class="gg_subtop">
            <% if(spath == 'research') { %>
            <img src="/images/gg_topimg_07.jpg" alt="" width="100%" />
            <% } else { %>
            <img src="/images/gg_topimg_08.jpg" alt="" width="100%" />
            <% } %>
      </div>

        <!--내용-->
        <div class="subcon tb">
            <!--좌측메뉴-->
            <%- include('partials/ggaside') %>

            <!--우측메뉴-->
            <div class="subright tbcelltop">
                <!--서브타이틀-->
                <div class="subtt">
                    <h2>상세페이지</h2>
                    <span>
                        <a href="/"><img src="/images/s_home.png" alt="home" /></a>
                        &nbsp;>&nbsp;
                        <% if(spath == 'research') { %><a href="#">연구보고</a><% } else { %>
                        <a href="#">소통공간</a>
                        <% } %>
                        &nbsp;>&nbsp;
                        <% if(spath == 'research') { %><a href="#">연구보고</a><% } %>
                        <% if(spath == 'notice') { %><a href="#">공지사항</a><% } %>
                        <% if(spath == 'news') { %><a href="#">센터소식</a><% } %>
                        <% if(spath == 'reference') { %><a href="#">자료실</a><% } %>
                        <% if(spath == 'review') { %><a href="#">센터이용후기</a><% } %>
                        <% if(spath == 'faq') { %><a href="#">FAQ</a><% } %>
                        &nbsp;>&nbsp;
                        <a href="#">상세페이지</a>
                    </span>
                </div>

                <!--서브컨텐츠-->
                <div class="subconbox">

                    <!-- 리드면 비밀번호 확인 페이지 -->
                    <form action="">
                        <div class="bdpass" style="display: none;">
                        <div class="bdpassbox">
                            비밀번호를 입력하세요
                            <input type="password" name="wpw" autocomplete="off">
                            <div class="bdwritebtn">
                            <a href="javascript:void(0);" class="cancelbtn" onclick="document.getElementsByClassName('bdpass')[0].style.display='none'">취소</a>&nbsp;&nbsp;
                            <a href="javascript:void(0);" class="writebtn review-delete" style="display: none;">확인</a>
                            <a href="javascript:void(0);" class="writebtn review-update" style="display: none;">확인</a>
                            </div>
                        </div>
                        </div>
                    </form>




                    <!--게시판 // 글쓰기 페이지-->
                    <div class="bdw_wrap bdr">
                        <div class="bdwrite tb">
                            <span class="tbcellm att" id="title"></span>
                        </div>
                        <div class="bdwrite tb d-flex" style="padding-left: 30px;">
                            <div class="d-flex writer">
                                <span>작성자 : </span>
                                <span class="tbcellm" id="writer"></span>
                            </div>
                            <div class="d-flex date">
                                <span>등록일 : </span>
                                <span class="tbcellm " id="reg_date"></span>
                            </div>
                            <div class="d-flex hit">
                                <span>조회수 : </span>
                                <span class="tbcellm " id="hit"></span>
                            </div>
                        </div>

                        <div id="file-list">
                            <!-- javascript code -->
                            <% if(typeof(fileResult) !== 'undefined' & fileResult.length != 0) { %>
                                <div style="padding: 10px; padding-left: 30px;">
                                    <% for (let i=0; i<fileResult.length; i++) { %>
                                        <div class="mb-4">
                                            <!--begin::Item-->
                                            <div class="d-flex align-items-center mb-n1">
                                                <!--begin::Bullet-->
                                                <span class="bullet me-3"></span>
                                                <!--end::Bullet-->
                                                <!--begin::Label-->
                                                <a href="/uploads/board/<%= fileResult[i].file_url %>.<%= fileResult[i].file_type %>" download="<%= fileResult[i].file_originname %>"><div class="text-gray-600 fw-bold fs-6"><%= fileResult[i].file_originname %> <span>(<%= fileResult[i].file_size %>)</span></div></a>
                                                <!--end::Label-->
                                            </div>
                                            <!--end::Item-->
                                        </div>
    
                                    <% } %>
                                </div>
                                <div style="border-bottom: 1px solid #d5d5d5;"></div>
                            <% } %>
                        </div>

                        <!-- <div class="bdwrite tb">
                            <div class="tbcellm wpw">비밀번호</div>
                            <div class="tbcellm apw" name="password"></div>
                        </div> -->
                        <div class="bdwrite tb">
                            <div class="tbcellm acon"  id="content" style="white-space: pre;"></div>
                        </div>
                        <!--bdw_wrap-->
                    </div>
                    <!--서브컨텐츠 여기까지-->
                    <!--글등록 // 취소-->
                    <div class="bdwritebtn">
                        <a href="javascript:void(0);" onclick="location.href='<% if(spath !== 'research') { %>/commu/<%= spath %><% } else { %>/research<% } %>';" class="cancelbtn">목록</a>&nbsp;&nbsp;
                        <% if(spath == 'review') { %><a href="javascript:void(0);" onclick="bdpass(1)" class="writebtn" style="margin-right: 4px;">수정</a><% } %>
                        <% if(spath == 'review') { %><a href="javascript:void(0);" onclick="bdpass(0)" class="writebtn">삭제</a><% } %>
                    </div>
                </div>
            </div>
            <!--subright여기까지-->
        </div>
        <!--subcon tb 여기까지-->

        <!--QUICK-->
        <%- include('partials/ggquick') %>

    </div>
    <!--컨텐츠 여기까지-->


    <!--FOOTER-->
    <%- include('partials/gg_footer') %>

    <!--gg_wrap 여기까지-->

<script>
    const reviewUpdate = document.getElementsByClassName('review-update')[0];
    const reviewDelete = document.getElementsByClassName('review-delete')[0];

    if (reviewDelete) {
        reviewDelete.addEventListener('click', () => {
            const query = new URLSearchParams(location.search);

            $.ajax({
                type: 'post',
                url: '/review/delete',
                data: {
                    id: query.get('id'),
                    pwd: document.getElementsByName('wpw')[0].value,
                },
                dataType: "json"
                ,success: function(response) {
                    //console.log(response);
                    if(response.result != `review-error`) {

                        if(response.data != null && response.data != `pwd error`) {
                            alert('삭제 되었습니다.');
                            location.href = '/commu/review';

                        } else {
                            alert('오류입니다.');
                        }
                    } else {
                        alert('비밀번호를 확인해주세요.');
                    }
                }, error : function(request, status, error ) {   // 오류가 발생했을 때 호출된다.
                }
            });
        });
    } else {}

    if (reviewUpdate) {
        reviewUpdate.addEventListener('click', () => {
            const query = new URLSearchParams(location.search);

            $.ajax({
                type: 'post',
                url: '/review/update',
                data: {
                    id: query.get('id'),
                    pwd: document.getElementsByName('wpw')[0].value,
                },
                dataType: "json"
                ,success: function(response) {
                    //console.log(response);
                    if(response.result != `review-error`) {

                        if(response.data != null && response.data != `pwd error`) {
                            // 수정 페이지로 이동
                            location.href = `/commu/review/update?id=${query.get('id')}`;

                        } else {
                            alert('오류입니다.');
                        }
                    } else {
                        alert('비밀번호를 확인해주세요.');
                    }
                }, error : function(request, status, error ) {   // 오류가 발생했을 때 호출된다.
                }
            });
        });
    } else {}

    getBoardDetailData();

    function getBoardDetailData() {
            const path = location.pathname.split('/');
            const query = new URLSearchParams(location.search);

            let board = '';

            if (path[1] == 'research') {
                board = path[1];
            } else {
                board = path[2];
            }

            $.ajax({
                type: 'GET',
                url: `/commu/${board}/detail/data?id=${query.get('id')}`,
                dataType: "json"
                ,success: function(response) {
                    //console.log(response);
                    if(response.result != `board-error`) {

                        if(response.data != null && response.result != `${board}-error`) {
                            const result = response.data
                            document.getElementById('title').innerText = result.title;
                            document.getElementById('writer').innerText = result.writer;
                            document.getElementById('reg_date').innerText = result.reg_date;
                            document.getElementById('hit').innerText = result.hit;
                            document.getElementById('content').innerHTML = result.content;
                        } else {}
                    } else {

                    }
                }, error : function(request, status, error ) {   // 오류가 발생했을 때 호출된다.

            }
        });
    }

    function bdpass(s) {
        document.getElementsByClassName('bdpass')[0].style.display='block';

        // 수정
        if (s == 1) {
            reviewUpdate.style.display='inline-block';
            reviewDelete.style.display='none';
        } else {
            reviewDelete.style.display='inline-block';
            reviewUpdate.style.display='none';
        }
    }
</script>
